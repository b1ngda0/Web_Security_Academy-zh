---
description: '原文链接：https://portswigger.net/web-security/authentication/password-based'
---

# 基于密码登录中的漏洞

在本节中，我们将更仔细地研究一些基于密码的登录机制中最常见的漏洞。我们还将提出这些漏洞有可能被利用的方法。甚至还有一些互动实验，让你可以自己尝试利用这些漏洞。

对于采用基于密码的登录过程的网站，用户要么自己注册一个账户，要么由管理员分配一个账户。这个账户与一个独特的用户名和一个秘密密码相关联，用户在登录表格中输入这些密码来验证自己。

在这种情况下，仅凭他们知道秘密密码这一事实，就足以证明用户的身份。因此，如果攻击者能够获得或猜到另一个用户的登录凭证，网站的安全性就会受到影响。

这可以通过各种方式实现，我们将在下面探讨。

### 暴力破解攻击

暴力破解攻击是指攻击者使用反复试验的系统来试图猜测有效的用户凭证。这些攻击通常是使用用户名和密码的字典自动进行的。自动化这一过程，特别是使用专用工具，有可能使攻击者能够高速进行大量的登录尝试。

暴力破解并不总是只对用户名和密码进行完全随机的猜测。通过使用基本的逻辑或公开的常识，攻击者可以对暴力攻击进行微调，以做出更有根据的猜测。这大大提高了这种攻击的效率。依赖密码登录作为唯一验证用户身份方法的网站，如果不实施足够的暴力破解攻击保护，将非常容易受到攻击。

#### 暴力破解用户名 <a id="brute-forcing-usernames"></a>

如果用户名符合一种可识别的模式，如电子邮件地址，那么就特别容易被猜中。例如，很常见的是，商业网站登录的格式是`firstname.lastname@somecompany.com`。然而，即使没有明显的模式，有时甚至高权限的账户也是使用可预测的用户名创建的，如`admin`或`administrator`。

在审计过程中，检查网站是否公开了潜在用户名。例如，你是否能够在不登录的情况下访问用户档案？即使档案的实际内容被隐藏，用户档案中使用的名字有时与登录用户名相同。你还应该检查HTTP响应，看看是否有任何电子邮件地址被泄漏。偶尔，响应中会包含管理员和IT支持等高权限用户的电子邮件地址。

#### 暴力破解密码 <a id="brute-forcing-passwords"></a>

密码也同样可以被暴力破解，其难度根据密码的强度而变化。许多网站采用了某种形式的密码策略，迫使用户创建高熵的密码，至少在理论上，这种密码更难被暴力破解。这通常包括强制要求密码具有：

* 最少的字符数 
* 小写和大写字母的混合体 
* 至少有一个特殊字符 

然而，虽然高熵的密码仅靠计算机是很难破解的，但我们可以利用人类行为的基本常识来利用用户在不知不觉中引入该系统的漏洞。用户往往不是用随机的字符组合来创建一个强大的密码，而是采取一个他们能够记住的密码，并试图将其与密码策略相匹配。例如，如果不允许使用`mypassword`，用户可能会尝试使用`Mypassword1!`或`Myp4$$w0rd`这样的东西来代替。

在政策要求用户定期更改密码的情况下，用户通常会对他们的首选密码进行微小的、可预测的更改。例如，`Mypassword1!`变成了`Mypassword1?`或`Mypassword2!`。

这种对可能的凭证和可预测的模式的了解，意味着暴力攻击往往比简单地迭代每一个可能的字符组合要复杂得多，因此也有效。

#### 用户名枚举 <a id="username-enumeration"></a>

用户名枚举是指攻击者能够观察到网站行为的变化，以确定一个特定的用户名是否有效。

用户名枚举通常发生在登录页面，例如，当你输入一个有效的用户名但密码不正确时，或者在注册表格中输入一个已经被占用的用户名时。这大大减少了暴力登录所需的时间和精力，因为攻击者能够迅速生成一个有效用户名的短名单。

在尝试对登录页面进行暴力破解时，你应该特别注意以下方面的任何差异：

**状态码**：在暴力破解攻击中，返回的HTTP状态码对于绝大多数的猜测都可能是一样的，因为大多数的猜测都是错误的。如果一个猜测返回一个不同的状态码，这是一个强有力的迹象，表明该用户名是正确的。对于网站来说，无论结果如何，总是返回相同的状态码是最好的做法，但这种做法并不总是被遵循。

**错误信息**：有时返回的错误信息是不同的，这取决于用户名和密码都不正确，还是只有密码不正确。对于网站来说，最好的做法是在这两种情况下都使用相同的通用信息，但小的输入错误有时会悄悄出现。只要有一个字符出错，就会使两种信息截然不同，即使在渲染的页面上看不到该字符。

**响应时间**：如果大多数请求的处理都有类似的响应时间，那么任何偏离这个时间的请求都表明在幕后有不同的事情发生。这是另一个迹象，表明猜测的用户名可能是正确的。例如，一个网站可能只在用户名有效的情况下检查密码是否正确。这个额外的步骤可能会导致响应时间的轻微增加。这可能是微妙的，但攻击者可以通过输入一个过长的密码，使网站需要明显的时间来处理，从而使这种延迟更加明显。

> 实验：[通过不同的响应来枚举用户名](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-different-responses)

> 实验：[通过细微不同的响应枚举用户名](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-subtly-different-responses)

> 实验：[通过响应时间枚举用户名](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-response-timing)

### 有缺陷的暴力破解保护

在攻击者成功入侵一个账户之前，暴力破解攻击极有可能涉及许多失败的猜测。从逻辑上讲，暴力破解攻击保护是围绕着尽量使其成为一个棘手的自动化过程，并减慢攻击者尝试登录的速度。防止暴力攻击的两个最常见的方法是。

* 如果远程用户尝试登录失败的次数过多，就锁定他们试图访问的账户
* 如果远程用户连续进行了太多的登录尝试，则封锁其IP地址。 

这两种方法都提供了不同程度的保护，但都不是无懈可击的，尤其是在使用有缺陷的逻辑实现时。

例如，有时你可能会发现，如果你登录失败的次数过多，你的IP就会被封锁。在一些实现中，如果IP所有者成功登录，失败次数的计数器就会重置。这意味着攻击者只需每隔几次就登录自己的账户，以防止达到这个限制。

在这种情况下，只需在整个字典中定期包含自己的登录凭证，就足以使这种防御几乎毫无用处。

> 实验：[破坏暴力破解保护，IP封锁](https://portswigger.net/web-security/authentication/password-based/lab-broken-bruteforce-protection-ip-block)

#### 账户锁定

网站试图防止暴力破解攻击的一种方法是，如果满足某些可疑的标准，通常是登录失败的设定次数，就会锁定账户。就像正常的登录错误一样，来自服务器的显示账户被锁定的响应也可以帮助攻击者列举用户名。

> 实验：[通过账户锁定枚举用户名](https://portswigger.net/web-security/authentication/password-based/lab-username-enumeration-via-account-lock)

锁定账户提供了一定程度的保护，防止对特定账户进行有针对性的暴力破解攻击。然而，这种方法不能充分防止暴力破解攻击，在这种攻击中，攻击者只是试图获得对任意随机账户的访问。

例如，下面的方法可以用来绕过这种保护：

1. 建立一个可能是有效的候选用户名的列表。这可以通过用户名列举或简单地基于一个常见的用户名列表。
2. 决定一个非常小的密码短名单，你认为至少有一个用户可能拥有这些密码。最重要的是，你选择的密码数量不能超过允许的登录次数。例如，如果你已经计算出限制是3次尝试，你需要选择最多3个密码猜测。
3. 使用诸如Burp Intruder这样的工具，用每个候选的用户名尝试每个选定的密码。这样，你可以在不触发账户锁的情况下尝试对每个账户进行暴力破解。你只需要一个用户使用这三个密码中的一个，就可以攻破一个账户。

帐户锁定也不能防止凭证填充攻击。这涉及到使用大量的用户名:密码对的字典，由数据泄露中窃取的真实登录凭证组成。凭证填充攻击依赖于这样一个事实，即许多人在多个网站上重复使用相同的用户名和密码，因此，字典中的一些受损凭证也有可能在目标网站上有效。帐户锁定并不能防止凭证堵塞，因为每个用户名只被尝试一次。凭证填充特别危险，因为它有时会导致攻击者只用一次自动攻击就能破坏许多不同的账户。

#### 用户速率限制

网站试图防止暴力破解攻击的另一种方式是通过用户速率限制。在这种情况下，在短时间内发出过多的登录请求会导致你的IP地址被封锁。通常情况下，IP只能通过以下一种方式解封。

* 在经过一段时间后自动解封
* 由管理员手动操作
* 由用户在成功完成验证码后手动解封

用户速率限制有时比账户锁定更受欢迎，因为它不容易受到用户名枚举和拒绝服务攻击。然而，它仍然不是完全安全的。正如我们在先前的实验中看到的一个例子，攻击者有几种方法可以操纵他们的表面IP，以绕过阻止。

由于限制是基于从用户的IP地址发出的HTTP请求的速率，如果你能想出如何用一个请求猜出多个密码，有时也有可能绕过这一防御。

> 实验：[破坏暴力破解保护，每个请求有多个凭据](https://portswigger.net/web-security/authentication/password-based/lab-broken-brute-force-protection-multiple-credentials-per-request)

### HTTP basic认证 <a id="http-basic-authentication"></a>

尽管相当古老，但它的相对简单和易于实现意味着你有时可能会看到HTTP basic认证被使用。在HTTP basic认证中，客户端从服务器收到一个认证令牌，该令牌由用户名和密码连接而成，并以Base64编码。这个令牌由浏览器存储和管理，浏览器会自动将其添加到每个后续请求的`Authorization`头中，具体如下。

`Authorization: Basic base64(username:password)`

由于一些原因，这通常不被认为是一种安全的认证方法。首先，它涉及到在每次请求中重复发送用户的登录凭证。除非网站也实现了HSTS，否则用户凭证很容易被中间人攻击所捕获。

此外，HTTP basic认证的实现通常不支持暴力破解保护。由于令牌完全由静态值组成，这可能使其容易被暴力破解。

HTTP basic认证也特别容易受到与会话相关的攻击，特别是CSRF，它本身不提供保护。

在某些情况下，利用脆弱的HTTP basic认证可能只允许攻击者访问一个看起来不感兴趣的页面。然而，除了提供一个进一步的攻击面之外，以这种方式暴露的凭证可能会在其他更机密的情况下被重新使用。





















